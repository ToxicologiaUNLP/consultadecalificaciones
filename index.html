<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Asistencia y Calificaciones - Toxicología UNLP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="icon" href="logo1.png" type="image/png" />

<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel="stylesheet">

<style>
  :root {
    --primary: #2d8390;
    --primary-dark: #1e5a63;
    --accent: #38828f;
    --bg-gradient: linear-gradient(135deg, #087882 0%, #0c8c9c 40%, #045c63 70%, #04545d 100%);
    --white: #ffffff;
    --gray-bg: #fdfdfd;
  }

  * { box-sizing: border-box; }
  html, body { height: 100%; margin: 0; }

  body {
    font-family: 'Open Sans', sans-serif;
    background: var(--bg-gradient);
    background-attachment: fixed;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    color: #333;
  }

  /* === MAIN CONTAINER === */
  main {
    max-width: 650px;
    width: 92%;
    background: var(--white);
    margin: 40px auto;
    padding: 2.5em;
    border-radius: 20px;
    box-shadow: 0 15px 35px rgba(0,0,0,0.3);
    flex: 0 1 auto; /* Ajuste para que no se estire innecesariamente */
    border-top: 6px solid var(--accent);
  }

  header {
    text-align: center;
    margin-bottom: 30px;
  }

  header img {
    width: 100%;
    max-width: 450px;
    height: auto;
    border-radius: 12px;
    margin-bottom: 10px;
  }

  .titulo-centro {
    font-family: 'Montserrat', sans-serif;
    font-weight: 800;
    font-size: 1.6em;
    color: var(--primary-dark);
    margin: 15px 0;
    letter-spacing: -0.5px;
    text-transform: uppercase;
  }

  /* === FORMULARIO === */
  #formBuscador p {
    font-size: 0.95em;
    color: #555;
    line-height: 1.5;
    margin-bottom: 20px;
  }

  label {
    font-weight: 700;
    font-size: 0.9em;
    color: var(--primary-dark);
    margin-bottom: 8px;
    display: block;
    text-transform: uppercase;
  }

  input[type="text"],
  input[type="email"] {
    width: 100%;
    padding: 12px 15px;
    font-size: 1em;
    border: 2px solid #e1e1e1;
    border-radius: 10px;
    transition: all 0.3s ease;
    background: #fcfcfc;
    margin-bottom: 5px;
  }

  input:focus {
    border-color: var(--primary);
    background: var(--white);
    outline: none;
    box-shadow: 0 0 0 4px rgba(45, 131, 144, 0.1);
  }

  small {
    display: block;
    margin-top: 5px;
    margin-bottom: 20px;
    line-height: 1.3;
  }

  /* === BOTONES === */
  button {
    border-radius: 10px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    text-transform: uppercase;
  }

  #btnConsultar {
    width: 100%;
    background: var(--primary);
    color: white;
    padding: 16px;
    font-size: 1em;
    margin-top: 10px;
    box-shadow: 0 4px 12px rgba(45, 131, 144, 0.3);
  }

  #btnConsultar:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: 0 6px 15px rgba(45, 131, 144, 0.4);
  }

  #btnVolver {
    background: #666;
    color: white;
    padding: 10px 25px;
    font-size: 0.8em;
    margin: 25px auto 0;
  }

  /* === TABLA DE RESULTADOS === */
  .tabla-scroll {
    border-radius: 12px;
    overflow: hidden;
    border: 1px solid #eee;
    margin-top: 15px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.05);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
  }

  th {
    background: #f4f7f8;
    color: var(--primary-dark);
    font-weight: 700;
    text-transform: uppercase;
    font-size: 0.85em;
    border-bottom: 2px solid #ddd;
  }

  th, td {
    padding: 14px;
    text-align: center;
    border-right: 1px solid #eee;
  }

  td {
    font-size: 1em;
    color: #444;
    /* Marca de agua integrada en el diseño de celda */
    background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="80" height="20"><text x="0" y="15" font-family="Arial" font-size="8" fill="rgba(0,0,0,0.03)">UNLP</text></svg>');
  }

  /* === INFO INSTITUCIONAL === */
  .info-institucional {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 10px;
    margin-top: 25px;
    border-left: 4px solid var(--accent);
    font-family: inherit;
    font-size: 0.8em;
    color: #666;
    pointer-events: auto;
    user-select: auto;
  }

  /* === MODAL MODERNO === */
  .overlay {
    background: rgba(4, 84, 93, 0.8);
    backdrop-filter: blur(4px);
  }

  .modal {
    border: none;
    box-shadow: 0 25px 50px rgba(0,0,0,0.4);
    padding: 35px;
  }

  .modal h3 {
    color: var(--primary-dark);
    font-family: 'Montserrat', sans-serif;
    border-bottom: 2px solid #eee;
    padding-bottom: 15px;
  }

  #cerrarCondiciones {
    background: #eee;
    color: #333;
    top: 15px;
    right: 15px;
  }

  #cerrarCondiciones:hover { background: #ddd; }

  footer {
    color: rgba(255,255,255,0.8);
    padding: 20px;
    font-size: 0.8em;
  }

  @media (max-width: 600px) {
    main { padding: 1.5em; width: 100%; border-radius: 0; margin: 0; }
    .titulo-centro { font-size: 1.3em; }
  }
</style>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>
<body>

<main>
  <header>
    <img src="logop.png" alt="Logo Cátedra" />
    <div class="titulo-centro">Consulta de Calificaciones</div>
  </header>

  <div id="contenido">
    </div>
</main>

<footer>
  <strong>Cátedra de Toxicología</strong><br>
  Facultad de Ciencias Médicas - Universidad Nacional de La Plata
</footer>

<div class="overlay" id="modalCondiciones">
  <div class="modal">
    <span id="cerrarCondiciones">&times;</span>
    <h3>Reglamento de Cátedra</h3>
    <div style="text-align:left; font-size:0.9em; color:#444; line-height:1.6;">
      <p><strong>Cursada regular CON examen final:</strong> Requiere 80% de actividades cumplidas (máximo 1 falta en TP de casos clínicos y 1 en Evaluación Formativa). Parcial presencial aprobado con 4 o más.</p>
      <p><strong>Promoción SIN examen final:</strong> Requiere 80% de actividades, asistencia obligatoria a Simulación Clínica, aprobación de evaluación conceptual (7+) y parcial oral (7+).</p>
      <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">
      <p style="font-style:italic; font-size:0.85em;">Para más detalles, consulte la cartelera oficial de la Facultad.</p>
    </div>
  </div>
</div>

<script>
// --- TU LÓGICA DE NEGOCIO (SIN CAMBIOS) ---
const urlBase = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vReNWOvv7g2rK58C0Ari6MtMo8LT1Si1hYRm_hueR-ad88Utj6TlK0wfMyJJEHv1Q/pub?output=csv';

async function cargarDatos(url) {
  const res = await fetch(url, { cache: "no-store" });
  const text = await res.text();
  return Papa.parse(text, { header: true, skipEmptyLines: true, delimiter: "," });
}

async function verificarEstado() {
  try {
    const datos = await cargarDatos(urlBase + '&_ts=' + Date.now());
    const filaEstado = datos.data.find(row => row.Estado && row.Estado.trim() !== "");
    const estado = filaEstado?.Estado?.trim().toLowerCase();
    const contenido = document.getElementById('contenido');

    if (estado === 'habilitado') {
      contenido.innerHTML = `
      <div id="formBuscador">
        <p>Complete los datos para consultar su estado académico actual en la asignatura.</p>
        <label for="legajo">Número de Legajo</label>
        <input type="text" id="legajo" placeholder="Ej: 12345/6" autocomplete="off" />
        
        <label for="email">E-mail (SIU Guaraní)</label>
        <input type="email" id="email" placeholder="alumno@correo.com" autocomplete="off" />
        <small style="color:#777;">* Utilice el correo registrado en el sistema oficial de la UNLP.</small>
        
        <button id="btnConsultar">Consultar Sistema</button>
      </div>
      <div id="loader"><span>.</span><span>.</span><span>.</span></div>
      <div id="resultado"></div>
      <div id="error"></div>
      `;
      
      const legajoInput = document.getElementById('legajo');
      const emailInput = document.getElementById('email');
      const btnConsultar = document.getElementById('btnConsultar');
      [legajoInput,emailInput].forEach(inp=>inp.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault(); buscarNota();}}));
      btnConsultar.addEventListener('click',buscarNota);
    } else {
      contenido.innerHTML = `
        <div style="border: 2px dashed var(--primary); background: #f4f7f8; padding: 2em; border-radius: 12px; text-align: center; color: var(--primary-dark);">
          <strong style="font-size:1.2em;">Plataforma en Mantenimiento</strong><br><br>
          La consulta de notas no está disponible en este momento.<br>Por favor, intente nuevamente más tarde.
        </div>
      `;
    }
  } catch(e){ 
    document.getElementById('contenido').innerHTML=`<p style="color:red; text-align:center;">Error de conexión con el servidor institucional.</p>`;
  }
}

async function buscarNota(){
  const legajoInput = document.getElementById('legajo').value.trim().toLowerCase();
  const emailInput = document.getElementById('email').value.trim().toLowerCase();
  const resultado = document.getElementById('resultado');
  const errorDiv = document.getElementById('error');
  const loader = document.getElementById('loader');
  
  resultado.innerHTML = ""; errorDiv.textContent="";
  if(!legajoInput || !emailInput){errorDiv.textContent="Debe completar ambos campos."; return;}
  loader.style.display="block";

  try{
    const parsed = await cargarDatos(urlBase + '&_ts=' + Date.now());
    const columnas = parsed.meta.fields;
    const fila = parsed.data.find(row=>row['Legajo'] && row['Email'] && row['Legajo'].trim().toLowerCase()===legajoInput && row['Email'].trim().toLowerCase()===emailInput);
    
    loader.style.display="none";
    
    if(!fila){
      errorDiv.style.padding = "15px";
      errorDiv.innerHTML="⚠️ No se encontraron registros que coincidan con los datos ingresados."; 
      return;
    }

    const primeraColumna = columnas[0];
    const nombre = fila[primeraColumna] || "Alumno";
    const columnasExcluir = ['legajo','nombre','apellido','nombre y apellido','alumno','email','estado', primeraColumna.toLowerCase()];
    const columnasVisibles = columnas.filter(col=>!columnasExcluir.includes(col.toLowerCase()) && fila[col] && fila[col].trim()!=='');
    
    document.getElementById('formBuscador').style.display = 'none';

    let tablaHTML = `<div style="text-align:left; margin-bottom:15px;"><span style="color:#777; font-size:0.9em;">Estudiante:</span><br><strong style="font-size:1.2em; color:var(--primary-dark)">${nombre}</strong></div>`;
    tablaHTML += `<div class="tabla-scroll"><table><thead><tr>`;
    columnasVisibles.forEach(col=>tablaHTML+=`<th>${col}</th>`);
    tablaHTML+=`</tr></thead><tbody><tr>`;
    columnasVisibles.forEach(col=>tablaHTML+=`<td>${fila[col]}</td>`);
    tablaHTML+=`</tr></tbody></table></div>`;
    
    tablaHTML += `<button id="btnVolver">Nueva Consulta</button>`;
    tablaHTML += `
      <div class="info-institucional">
        Sujeto a las <a href="javascript:void(0)" class="link-condiciones" style="color:var(--primary); font-weight:bold;">condiciones de cátedra</a>.<br>
        Esta información tiene carácter de declaración informativa institucional.
      </div>
    `;

    resultado.innerHTML = tablaHTML;

    document.getElementById('btnVolver').addEventListener('click',()=>{
      document.getElementById('formBuscador').style.display='block';
      resultado.innerHTML='';
    });

  } catch(e){
    loader.style.display="none"; 
    errorDiv.textContent="Error al procesar la solicitud.";
  }
}

// Lógica de Modal (Sin cambios)
document.addEventListener('DOMContentLoaded', () => {
  const modal = document.getElementById('modalCondiciones');
  verificarEstado();

  document.addEventListener('click', (e)=>{
    if (e.target.classList.contains('link-condiciones')) {
      e.preventDefault();
      modal.style.display = 'flex';
    }
    if(e.target.id === 'cerrarCondiciones' || e.target.id === 'modalCondiciones'){
      modal.style.display = 'none';
    }
  });
});
</script>
</body>
</html>





























































































































































































































































































































































































































































































