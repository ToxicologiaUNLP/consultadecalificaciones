<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Asistencia y Calificaciones - Toxicología UNLP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<link rel="icon" href="logo1.png" type="image/png" />

<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&display=swap" rel="stylesheet">

<style>
* { box-sizing: border-box; }
html, body { height: 100%; margin: 0; }

body {
  font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #087882 0%, #0c8c9c 40%, #045c63 70%, #04545d 100%);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

/* === MAIN === */
main {
  max-width: 600px;
  width: 100%;
  background: #f9f8f5;
  margin: 30px auto 2em auto;
  padding: 2em;
  border-radius: 16px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
  flex: 1;
}

main header { text-align: center; margin-bottom: 25px; }
main header img { width: 100%; height: auto; border-radius: 16px; box-shadow: 0 3px 8px rgba(0,0,0,0.18); }

.titulo-centro {
  font-family: 'Open Sans', sans-serif;
  font-weight: 700;
  font-size: 1.8em;
  color: #38828f;
  margin-top: 15px;
}

/* === BUSCADOR === */
label { font-weight: 600; margin-top: 1em; display: block; color: #444; }
input { width: 100%; padding: 0.8em; margin: 0.5em 0; border: 2px solid #ccc; border-radius: 8px; font-size: 1em; }

/* === BLOQUES VERTICALES === */
.categoria-bloque {
  margin-bottom: 20px;
  background: #ffffff;
  border-radius: 10px;
  padding: 15px;
  border: 1px solid #e0e6e7;
  border-left: 5px solid #38828f;
}

.categoria-titulo {
  font-family: 'Montserrat', sans-serif;
  font-size: 0.85em;
  color: #38828f;
  font-weight: 800;
  margin-bottom: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.grid-datos {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
  gap: 8px;
}

.dato-item {
  background: #f4f8f9;
  border: 1px solid #d1dfe1;
  padding: 10px 4px;
  border-radius: 6px;
  text-align: center;
}

.dato-label { display: block; font-size: 0.65em; color: #668a90; font-weight: 700; }
.dato-valor { display: block; font-size: 1.1em; font-weight: 800; color: #2c565d; }

/* Resaltado para Promoción */
.aprobado-promocion {
  background-color: #e8f5e9 !important;
  border-color: #a5d6a7 !important;
}
.aprobado-promocion .dato-valor { color: #2e7d32 !important; }

/* === REFERENCIAS === */
.seccion-referencias {
  margin-top: 25px;
  padding: 15px;
  background: #eeeeee;
  border-radius: 10px;
  font-size: 0.75em;
  color: #555;
  line-height: 1.6;
}
.seccion-referencias strong { color: #38828f; }

/* === BOTONES === */
button { width: 100%; border-radius: 8px; font-weight: 700; cursor: pointer; border: none; transition: 0.3s; }
#btnConsultar { background: #2d8390; color: white; padding: 1em; margin-top: 1em; font-size: 1.1em; }
#btnVolver { background: #607d8b; color: white; padding: 0.8em; margin-top: 20px; }
button:active { transform: scale(0.98); }

.info-institucional { font-size: 0.72em; color: #888; text-align: center; margin-top: 20px; line-height: 1.4; }
footer { color: white; text-align: center; padding: 1.5em; font-size: 0.8em; }

@media (max-width: 600px) {
  main { margin: 0; border-radius: 0; padding: 1.5em; }
}
</style>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>

<body>
<main>
  <header>
    <img src="https://notas-toxicologia-unlp.netlify.app/logop.png" alt="Logo Cátedra" />
    <div class="titulo-centro">CONSULTA DE NOTAS</div>
  </header>
  <div id="contenido"></div>
</main>

<footer>© 2026 Cátedra de Toxicología, FCM - UNLP.</footer>

<script>
const urlBase = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vReNWOvv7g2rK58C0Ari6MtMo8LT1Si1hYRm_hueR-ad88Utj6TlK0wfMyJJEHv1Q/pub?output=csv';

async function cargarDatos(url) {
  const res = await fetch(url, { cache: "no-store" });
  const text = await res.text();
  return Papa.parse(text, { header: true, skipEmptyLines: true });
}

async function verificarEstado() {
  try {
    const datos = await cargarDatos(urlBase + '&_ts=' + Date.now());
    const estado = datos.data.find(row => row.Estado)?.Estado?.trim().toLowerCase();
    const contenido = document.getElementById('contenido');

    if (estado === 'habilitado') {
      contenido.innerHTML = `
        <div id="formBuscador">
          <p style="font-size:0.9em; margin-bottom:15px;">Ingrese sus datos para visualizar su estado académico.</p>
          <label>Legajo</label><input type="text" id="legajo" placeholder="Ej: 12345/6" />
          <label>E-mail (SIU Guaraní)</label><input type="email" id="email" placeholder="alumno@correo.com" />
          <button id="btnConsultar">ACCEDER</button>
        </div>
        <div id="resultado"></div>
        <div id="error" style="color:red; text-align:center; margin-top:15px; font-weight:bold;"></div>`;
      
      document.getElementById('btnConsultar').onclick = buscarNota;
    } else {
      contenido.innerHTML = `<div style="text-align:center; padding:2em; color:#38828f; font-weight:600;">El sistema se encuentra momentáneamente fuera de servicio por actualización de datos.</div>`;
    }
  } catch(e) { console.error(e); }
}

async function buscarNota(){
  const legajo = document.getElementById('legajo').value.trim().toLowerCase();
  const email = document.getElementById('email').value.trim().toLowerCase();
  const resDiv = document.getElementById('resultado');
  const errorDiv = document.getElementById('error');
  
  errorDiv.textContent = "";
  if(!legajo || !email) { errorDiv.textContent = "Complete todos los campos."; return; }

  const parsed = await cargarDatos(urlBase + '&_ts=' + Date.now());
  const fila = parsed.data.find(row => row['Legajo']?.trim().toLowerCase() === legajo && row['Email']?.trim().toLowerCase() === email);

  if(!fila) {
    errorDiv.textContent = "Datos no encontrados. Verifique legajo y mail.";
    return;
  }

  document.getElementById('formBuscador').style.display = 'none';

  let html = `<p style="margin-bottom:15px;">Estudiante: <strong>${fila['Nombre'] || 'Alumno'}</strong></p>`;
  
  // Agrupación por categorías verticales
  html += generarBloque(fila, "T", "Clases Teóricas");
  html += generarBloque(fila, "P", "Trabajos Prácticos", ["PA", "Parcial"]);
  html += generarBloque(fila, "S", "Talleres de Simulación");
  html += generarBloque(fila, "ECP", "Examen Conceptual de Promoción", [], true);
  html += generarBloque(fila, "PA", "Evaluaciones Parciales", [], true);
  html += generarBloque(fila, "Parcial", "Nota de Parcial", [], true);

  // Referencias al final
  html += `
    <div class="seccion-referencias">
      <strong>Glosario de Referencias:</strong><br>
      <strong>T:</strong> Teóricos | <strong>P:</strong> Trabajos Prácticos | 
      <strong>S:</strong> Simulación Clínica | <strong>ECP:</strong> Examen Conceptual | 
      <strong>PA:</strong> Instancia de Parcial.
    </div>
  `;

  html += `<button id="btnVolver">REALIZAR OTRA CONSULTA</button>`;
  html += `<p class="info-institucional">Sujeto a las condiciones establecidas por la cátedra.<br>La información aquí expuesta tiene carácter oficial.</p>`;
  
  resDiv.innerHTML = html;
  document.getElementById('btnVolver').onclick = () => { location.reload(); };
}

function generarBloque(fila, prefijo, titulo, excluir = [], resaltarPromocion = false) {
  const columnas = Object.keys(fila).filter(col => {
    const c = col.toUpperCase();
    const p = prefijo.toUpperCase();
    return c.startsWith(p) && !excluir.some(ex => c.includes(ex.toUpperCase())) && fila[col]?.trim() !== "";
  });

  if (columnas.length === 0) return "";

  let b = `<div class="categoria-bloque"><div class="categoria-titulo">${titulo}</div><div class="grid-datos">`;
  columnas.forEach(c => {
    const valor = fila[c];
    // Si es examen, evaluamos si la nota es >= 7 para poner el color verde
    let claseExtra = "";
    if (resaltarPromocion && !isNaN(parseFloat(valor)) && parseFloat(valor) >= 7) {
      claseExtra = "aprobado-promocion";
    }

    b += `<div class="dato-item ${claseExtra}"><span class="dato-label">${c}</span><span class="dato-valor">${valor}</span></div>`;
  });
  return b + `</div></div>`;
}

window.onload = verificarEstado;
</script>
</body>
</html>























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































